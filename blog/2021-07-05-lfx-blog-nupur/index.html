<!doctype html><html lang=en-us><head><meta name=generator content="Hugo 0.85.0"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Support for the Syslog Protocol</title><meta name=description content="Nupur's experience contributing to Tremor and work overview"><meta name=author content="The Tremor Team"><meta property="og:title" content="Support for the Syslog Protocol"><meta property="og:description" content="Nupur's experience contributing to Tremor and work overview"><meta property="og:type" content="article"><meta property="og:url" content="/blog/2021-07-05-lfx-blog-nupur/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-07-05T11:04:54+00:00"><meta property="article:modified_time" content="2021-07-05T11:04:54+00:00"><link rel=canonical href=/blog/2021-07-05-lfx-blog-nupur/><link rel="shortcut icon" type=image/png href=/img/favicons/logo.png><link href=/css/font.css rel=stylesheet type=text/css><link href=/css/kube.css rel=stylesheet type=text/css><link href=/css/kube.legenda.css rel=stylesheet type=text/css><link href=/css/highlight.css rel=stylesheet type=text/css><link href=/css/master.css rel=stylesheet type=text/css><link href=/css/kube.demo.css rel=stylesheet type=text/css><link href=/css/custom.css rel=stylesheet type=text/css><link href=/css/syntax.css rel=stylesheet type=text/css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css><script src=/js/jquery-2.1.4.min.js type=text/javascript></script><script type=text/javascript src=/js/tocbot.min.js></script></head><body class=page-kube><header><div class=show-sm><div id=nav-toggle-box><div id=nav-toggle-brand><a href=/><img src=/logo-minimalism.png width=32 height=32 alt=Tremor></a></div><a data-component=toggleme data-target=#top href=# id=nav-toggle><i class=kube-menu></i></a></div></div><div class=hide-sm id=top><div id=top-brand><a href=/ title=home><img src=/img/common/logo.png height=64 width=285 alt=Tremor></a></div><nav id=top-nav-main><ul><li><a href=/blog/>Blog</a></li><li><a href=/faq/>Faq</a></li><li><a href=/getting-started/>Getting Started</a></li><li><a href=https://docs.tremor.rs/>Docs</a></li><li><a href=https://rfcs.tremor.rs/>RFCs</a></li><li><a href=/community/>Community</a></li><li><a href=/governance/>Governance</a></li><li><a href=https://bit.ly/tremor-discord>Community Chat</a></li></ul></nav><nav id=top-nav-extra><ul></ul></nav></div><a class=github-fork-ribbon href=https://github.com/tremor-rs/tremor-runtime data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a></header><main><div class=push-center itemscope itemtype=http://schema.org/BlogPosting><meta itemprop=name content="Support for the Syslog Protocol"><meta itemprop=description content="Nupur's experience contributing to Tremor and work overview"><meta itemprop=datePublished content="2021-07-05T11:04:54+00:00"><meta itemprop=dateModified content="2021-07-05T11:04:54+00:00"><meta itemprop=wordCount content="715"><meta itemprop=keywords content="codecs,mentorship,cncf,"><div id=hero><h2 itemprop=headline>Support for the Syslog Protocol</h2><blockquote itemprop=description>Nupur's experience contributing to Tremor and work overview</blockquote><time class=post-time><span class=icon><i class="fa fa-clock-o" aria-hidden=true></i></span>
<span>4 minute read</span>
<span class=icon><i class="fa fa-pencil" aria-hidden=true></i></span>
Published: <time datetime=2021-07-05T11:04:54+00:00>5 Jul, 2021</time></time></div><div id=post-box><div id=post itemprop=articleBody><h2 id=introduction>Introduction</h2><p>Hey folks, I am Nupur Agrawal, a third year student at Indian Institute of Technology Roorkee. This blog describes my experience of contributing to Tremor,
CNCF sandbox project in the 2021 spring chapter of <a href=https://lfx.linuxfoundation.org/tools/mentorship/>LFX Mentorship Program</a>, under the mentorship of
Matthias Wahl, Anup Dhamala and Heinz Gies.</p><h2 id=project-abstract>Project Abstract</h2><p><a href=https://www.tremor.rs/>Tremor</a> is an event processing system originally designed for the needs of platform engineering and infrastructure. It is built for
the users that have a high message volume to deal with and want to build pipelines to process, route, or limit this event stream.</p><p>At the beginning of the program, I was given walkthrough of the project by Matthias and he patiently explained me the components and working of tremor.
Tremor is nicely documented and the <a href=https://docs.tremor.rs/>docs</a> can be very useful for referring many things.</p><h2 id=my-project>My Project</h2><p>My project&rsquo;s aim was to enable tremor to receive and send <a href=https://tools.ietf.org/html/rfc5424>Syslog Protocol Messages</a>, a standard protocol used to send
system log or event messages. It was desired to support both the standard IETF format and the old BSD format via UDP and TCP/TLS. More detailed description
can be found <a href=https://github.com/tremor-rs/tremor-runtime/issues/12>here</a>.</p><h2 id=work-summary>Work-Summary</h2><h3 id=syslog-codec-support-via-udp>Syslog codec (support via UDP)</h3><p>The syslog codec encodes and decodes sylog messages (IETF and BSD format) to and from <code>Value</code> respectively. Tremor can now receive syslog data via UDP (onramp) and turn syslog messages into structured events. Also, structured events can be turned into textual syslog messages and send out via UDP (offramp).</p><p>For example, the following Syslog message</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>&lt;165&gt;1 2021-03-18T20:30:00.123Z mymachine.example.com evntslog - ID47 [exampleSDID@32473 iut=\&#34;3\&#34; eventSource=\&#34;Application\&#34; eventID=\&#34;1011\&#34;] BOMAn
application event log entry...&#34;
</code></pre></div><p>gets translated to:</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;severity&#34;</span><span class=p>:</span> <span class=s2>&#34;notice&#34;</span><span class=p>,</span>
  <span class=nt>&#34;facility&#34;</span><span class=p>:</span> <span class=s2>&#34;local4&#34;</span><span class=p>,</span>
  <span class=nt>&#34;hostname&#34;</span><span class=p>:</span> <span class=s2>&#34;mymachine.example.com&#34;</span><span class=p>,</span>
  <span class=nt>&#34;appname&#34;</span><span class=p>:</span> <span class=s2>&#34;evntsog&#34;</span><span class=p>,</span>
  <span class=nt>&#34;msg&#34;</span><span class=p>:</span> <span class=s2>&#34;BOMAn application event log entry...&#34;</span><span class=p>,</span>
  <span class=nt>&#34;procid&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
  <span class=nt>&#34;msgid&#34;</span><span class=p>:</span> <span class=s2>&#34;ID47&#34;</span><span class=p>,</span>
  <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;RFC5424&#34;</span><span class=p>,</span>
  <span class=nt>&#34;protocol_version&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
  <span class=nt>&#34;structured_data&#34;</span><span class=p>:</span> <span class=p>{</span>
              <span class=nt>&#34;exampleSDID@32473&#34;</span> <span class=p>:</span>
              <span class=p>[</span>
                <span class=p>{</span><span class=nt>&#34;iut&#34;</span><span class=p>:</span> <span class=s2>&#34;3&#34;</span><span class=p>},</span>
                <span class=p>{</span><span class=nt>&#34;eventSource&#34;</span><span class=p>:</span> <span class=s2>&#34;Application&#34;</span><span class=p>},</span>
                <span class=p>{</span><span class=nt>&#34;eventID&#34;</span><span class=p>:</span> <span class=s2>&#34;1011&#34;</span><span class=p>}</span>
              <span class=p>]</span>
            <span class=p>},</span>
  <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=mi>1616099400123000000</span>
<span class=p>}</span>
</code></pre></div><p>Code for the syslog codec can be found <a href=https://github.com/tremor-rs/tremor-runtime/pull/856>here</a>.</p><h3 id=textual-length-prefix-pre-and-postprocessor>textual-length-prefix pre and postprocessor</h3><p>In order to support syslog messages over TCP, it was needed to add support for the <a href=https://datatracker.ietf.org/doc/html/rfc5425>RFC 5425</a> transport protocol, that contains a textual length prefix before each message.
textual-length-prefix <code>preprocessor</code> and <code>postprocessor</code> were implemented to handle the buffers accordingly. The message starts with a number of digits, denoting the message length followed by a whitespace and then the message. The processor gets the length and then wait until the buffer is long enough, to extract the right amount of bytes.
The implementation can be found <a href=https://github.com/tremor-rs/tremor-runtime/pull/957>here</a>.</p><p><a href=https://github.com/altsysrq/proptest>Proptest</a> is something new and amazing I learnt while working on this. It is a property testing framework which allows to test certain properties of code for arbitrary inputs. We utilised this for testing the functioning of our preprocessor for all types of inputs possible.</p><h3 id=tls-support-for-tcp>TLS support for TCP</h3><p>Unlike UDP, Tremor did not support TLS over TCP onramp, which was needed to add. This work can be broadly divided into two parts:</p><p><strong>Add support for receiving TLS encrypted data via TCP onramp</strong></p><p><code>tls</code> option was added to the tcp onramp configuration options which addresses the keys and certificate required for authentiction.</p><p>An example of TCP onramp config with TLS is as follows:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>onramp</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>tls</span><span class=w>
</span><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>tcp</span><span class=w>
</span><span class=w>    </span><span class=nt>preprocessors</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=l>lines</span><span class=w>
</span><span class=w>    </span><span class=nt>codec</span><span class=p>:</span><span class=w> </span><span class=l>string</span><span class=w>
</span><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;127.0.0.1&#34;</span><span class=w>
</span><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>65535</span><span class=w>
</span><span class=w>      </span><span class=nt>tls</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>cert</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;path/to/cert.pem&#34;</span><span class=w>
</span><span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;path/to/key.pem&#34;</span><span class=w>
</span></code></pre></div><p>The code can be found <a href=https://github.com/tremor-rs/tremor-runtime/pull/1055>here</a>.</p><p><strong>Add support for sending TLS encrypted data via TCP offramp</strong></p><p><code>tls</code> option added to offramp tls config contains either the tls config or boolean value indiacting the use of TLS session for transport level encryption. If false is provided then the default TCP stream will be used and if true is provided then TLS stream will be used with default certificates and domain same as hostname. Other option is to provide tls config with <code>domain</code> and <code>cafile</code>. In case of <code>domain</code> not being specified, the hostname will be used.</p><p>An example of TCP offramp config with TLS:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>offramp</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>tls</span><span class=w>
</span><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>tcp</span><span class=w>
</span><span class=w>    </span><span class=nt>codec</span><span class=p>:</span><span class=w> </span><span class=l>json</span><span class=w>
</span><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;127.0.0.1&#34;</span><span class=w>
</span><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>65535</span><span class=w>
</span><span class=w>      </span><span class=nt>tls</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>cafile</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;path/to/cafile&#34;</span><span class=w>
</span></code></pre></div><p>The code can be found <a href=https://github.com/tremor-rs/tremor-runtime/pull/1057>here</a>.</p><h2 id=concluding-thoughts>Concluding Thoughts</h2><p>The tremor community is very helpful and friendly. The mentors helped me a lot from silly rust doubts to nerve breaking code debugging and testing. There were periodic code reviews and live coding sessions which motivated me to improvise and keep going. The key focus was always on the learning rather than getting the work done.</p><p>It was undoubtedly one of the most fruitful and learning experiences I had have and I wish to continue the contribution to community and project.</p></div><div><p>Published
by <span itemprop=author>The Tremor Team</span>
<time datetime=2021-07-05T11:04:54+00:00>5 Jul, 2021</time>
in <span itemprop=articleSection><a href=/categories/general/>general</a></span>
and tagged <a href=/tags/cncf/>cncf</a>, <a href=/tags/codecs/>codecs</a> and <a href=/tags/mentorship/>mentorship</a>
using <span itemprop=wordCount>715</span> words.</p><aside><heade><strong>Related Content</strong></header><hr><ul><li><a href=/blog/2021-07-06-blog-rohit-property-based-testing/>Property Based Testing of Tremor Script</a> &ndash; 7 minutes<li><a href=/blog/2021-06-29t17-lfx-blog-jigyasa-gcloud/>Google Cloud Storage and Pub/Sub connectors</a> &ndash; 11 minutes</ul></aside></div></div></div></main><footer><footer id=footer><nav><ul><li><a href=https://docs.tremor.rs/CodeOfConduct/>Code of Conduct</a></li><li><a href=https://www.tremor.rs/>The Tremor Project</a></li><li><a href=/blog/>Blog</a></li><li><a href=https://twitter.com/TremorDEBS>@TremorDEBS</a></li><li><a href=https://www.cncf.io/><img src=/img/cncf-color.svg alt="CNCF Logo" style=width:100px></a></li></ul></nav><p>&copy; 2020 The Tremor Contributors. Content under ASL 2 License. Theme
under MIT License.<br>Copyright The Linux Foundation. All rights reserved. The Linux Foundation
has registered trademarks and uses trademarks. For a list of trademarks of
The Linux Foundation, please see our
<a href=https://www.linuxfoundation.org/trademark-usage/>Trademark Usage</a>
page.<br>We are a
<a href=https://www.cncf.io/sandbox-projects/>Cloud Native Computing Foundation sandbox project</a></p></footer></footer><script src=/js/kube.js type=text/javascript></script><script src=/js/kube.legenda.js type=text/javascript></script><script src=/js/master.js type=text/javascript></script></body></html>