<!doctype html><html lang=en-us><head><meta name=generator content="Hugo 0.67.1"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Tremor Applications</title><meta name=description content="Scripting"><meta name=author content="The Tremor Team"><meta property="og:title" content="Tremor Applications"><meta property="og:description" content="Scripting"><meta property="og:type" content="article"><meta property="og:url" content="/getting-started/scripting/"><meta property="article:published_time" content="2020-02-05T13:11:00+01:00"><meta property="article:modified_time" content="2020-02-05T13:11:00+01:00"><link rel=canonical href=/getting-started/scripting/><link rel="shortcut icon" type=image/png href=img/favicons/logo.png><link href=/css/font.css rel=stylesheet type=text/css><link href=/css/kube.css rel=stylesheet type=text/css><link href=/css/kube.legenda.css rel=stylesheet type=text/css><link href=/css/highlight.css rel=stylesheet type=text/css><link href=/css/master.css rel=stylesheet type=text/css><link href=/css/kube.demo.css rel=stylesheet type=text/css><link href=/css/custom.css rel=stylesheet type=text/css><link href=/css/syntax.css rel=stylesheet type=text/css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css><script src=/js/jquery-2.1.4.min.js type=text/javascript></script><script type=text/javascript src=/js/tocbot.min.js></script></head><body class=page-kube><header><div class=show-sm><div id=nav-toggle-box><div id=nav-toggle-brand><a href=/><img src=/logo-minimalism.png width=32 height=32 alt=Tremor></a></div><a data-component=toggleme data-target=#top href=# id=nav-toggle><i class=kube-menu></i></a></div></div><div class=hide-sm id=top><div id=top-brand><a href=/ title=home><img src=/img/common/logo.png height=64 width=285 alt=Tremor></a></div><nav id=top-nav-main><ul><li><a href=/blog/>Blog</a></li><li><a href=/faq/>Faq</a></li><li><a href=/getting-started/>Getting Started</a></li><li><a href=https://docs.tremor.rs/>Docs</a></li><li><a href=https://rfcs.tremor.rs/>RFCs</a></li><li><a href=/community/>Community</a></li><li><a href=/governance/>Governance</a></li><li><a href=https://chat.tremor.rs/>Chat</a></li></ul></nav><nav id=top-nav-extra><ul></ul></nav></div><a class=github-fork-ribbon href=https://github.com/wayfair-tremor/tremor-runtime data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a></header><main><div id=main><div id=hero><h1>Tremor Applications</h1><p class=hero-lead>Tremor's application logic is scriptable.</p></div><div id=kube-component class=content><nav id=contents><ol class=js-toc></ol></nav><script type=text/javascript>document.addEventListener("DOMContentLoaded",function(){tocbot.init({tocSelector:'.js-toc',contentSelector:'.content',headingSelector:'h3'})});</script><h3 id=concept>Concept</h3><p>Tremor supports data processing through a directed acyclic graph based pipeline or
workflow. Pipelines can be configured via a YAML syntax or via a structured query
language.</p><p>Pipelines are a graph of operations through which events are routed depth first.
Operations in tremor pipelines are pluggable and extensible.</p><p>For applications or algorithms that process one event at a time, such as data cleansing,
enrichment, normalization, validation and transformation an ETL focused scripting language
can be used to program the application logic.</p><p>Qualities of service such as batching, bucketing and flushing semantics can be configured
into pipelines and data shared between oeprators through metadata exposed to the scripting
language.</p><p>The tremor query language replaces the YAML pipeline format with a more intuitive and easier
to program SQL-like language. The query language adds support for processing windows of events
over time to support near real-time grouping and aggregation.</p><p>For applications or algorithms that process events over time, such as those calculating summary
statistics, aggregating or projecting alternate views or other complex data processing and
routing logic the tremor query language is a better fit.</p><p>The query language embeds the scripting language allowing data-flow or query-oriented logic
to co-exist with ETL oriented logic.</p><p>Both the query and scripting language are evolving as tremor is applied to broader production
use cases.</p><h3 id=tremor-script>Tremor Script</h3><p>The scripting language supports JSON-like values. A valid JSON value is a valid tremor-script value.</p><p>Tremor-script adds an expression language that supports unary, binary, comparison and predicate
operations with higher level expressions supporting <code>match</code> expressions, <code>for</code> comprehensions and
<code>patch</code> and <code>merge</code> expressions.</p><p>Features relatively unique to tremor-script are structural pattern matching and the recognition
of and ability to extract data from microformats typically embedded in event data.</p><p><a href=https://docs.tremor.rs/tremor-script/#match>Structural pattern matching</a> allows patterns over
arbitrarily nested values to be concisely declared with an intuitive syntax.</p><p><a href=https://docs.tremor.rs/tremor-script/#extractors>Micro-format Extractors</a> allows embedded data
conforming to orthogonal formats such as regular expressions in Strings, date/time variants to
be conditionally transformed to tremor internal form and for embedded data to be extracted upon
matching.</p><pre><code class=language-tremor data-lang=tremor>define script extract                                # define the script that parses our apache logs
script
  match {&quot;raw&quot;: event} of                            # we user the dissect extractor to parse the apache log
    case r = %{ raw ~= dissect|%{ip} %{} %{} [%{timestamp}] &quot;%{method} %{path} %{proto}&quot; %{code:int} %{cost:int}\\n| }
            =&gt; r.raw                                 # this first case is hit if the log includes an execution time (cost) for the request
    case r = %{ raw ~= dissect|%{ip} %{} %{} [%{timestamp}] &quot;%{method} %{path} %{proto}&quot; %{code:int} %{}\\n| }
            =&gt; r.raw                                 # the second case is hit if the log does not includes an execution time (cost) for the request
    default =&gt; emit =&gt; &quot;bad&quot;
  end
end;
</code></pre><p>The full documentation <a href=https://docs.tremor.rs/tremor-script>of the language</a> and its <a href=https://docs.tremor.rs/tremor-script/functions>standard library</a> can be found in the <a href=https://docs.tremor.rs>docs</a>.</p><h3 id=tremor-query>Tremor Query</h3><p>Tremor query builds around <a href=#h-script>Tremor Script</a> and extends tremors capability to not only define scripts but turn pipeline configuration into development rather then YAML wrestling. In addition to describing pipelines Tremor Query adds the ability to group and aggregate events.</p><nav class=tabs data-component=tabs><ul><li class=active><a href=#before>Before (YAML)</a></li><li><a href=#after>After (Tremor Script)</a></li><li><a href=#logstash>Logstash</a></li></ul></nav><div id=before><p>The YAML based secription is unwieldy and easy to get wrong.</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>pipeline</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=k>id</span><span class=p>:</span><span class=w> </span>main<span class=w>
</span><span class=w>    </span><span class=k>interface</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>inputs</span><span class=p>:</span><span class=w>
</span><span class=w>        </span>- in<span class=w>
</span><span class=w>      </span><span class=k>outputs</span><span class=p>:</span><span class=w>
</span><span class=w>        </span>- out<span class=w>
</span><span class=w>    </span><span class=k>nodes</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=k>id</span><span class=p>:</span><span class=w> </span>runtime<span class=w>
</span><span class=w>        </span><span class=k>op</span><span class=p>:</span><span class=w> </span>runtime<span class=p>::</span>tremor<span class=w>
</span><span class=w>        </span><span class=k>config</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>script</span><span class=p>:</span><span class=w> </span><span class=sd>|
</span><span class=sd>            match {&#34;message&#34;: event} of</span><span class=w>
</span><span class=w>              </span>case<span class=w> </span>r<span class=w> </span>=<span class=w> </span>%{<span class=w> </span>message<span class=w> </span>~=<span class=w> </span>grok|%{IPORHOST<span class=p>:</span>clientip}·%{USER<span class=p>:</span>ident}·%{USER<span class=p>:</span>auth}·<span class=p>[</span>%{HTTPDATE<span class=p>:</span>timestamp}<span class=p>]</span>·<span class=s2>&#34;%{WORD:verb}·%{DATA:request}·HTTP/%{NUMBER:httpversion}&#34;</span>·%{NUMBER<span class=p>:</span>response<span class=p>:</span>int}·(<span class=p>?:</span>-\|%{NUMBER<span class=p>:</span>bytes<span class=p>:</span>int})·%{QS<span class=p>:</span>referrer}·%{QS<span class=p>:</span>agent}|<span class=w> </span>}<span class=w> </span>=&gt;<span class=w> </span>r.message<span class=w>
</span><span class=w>              </span>default<span class=w> </span>=&gt;<span class=w> </span>drop<span class=w>
</span><span class=w>            </span>end<span class=w>
</span><span class=w>    </span><span class=k>links</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>in</span><span class=p>:</span><span class=w> </span><span class=p>[</span>runtime<span class=p>]</span><span class=w>
</span><span class=w>      </span><span class=k>runtime</span><span class=p>:</span><span class=w> </span><span class=p>[</span>out<span class=p>]</span><span class=w>
</span></code></pre></div></div><div id=after><p>In trickle script the configuration becomes a query description based on a <code>select</code> statement to transofrm the data and a <code>having</code> clause to filter events we do not wish to keep.</p><pre><code class=language-trickle data-lang=trickle>select
  match {&quot;message&quot;: event} of
    case r = %{ message ~= grok|%{IPORHOST:clientip}·%{USER:ident}·%{USER:auth}·[%{HTTPDATE:timestamp}]·&quot;%{WORD:verb}·%{DATA:request}·HTTP/%{NUMBER:httpversion}&quot;·%{NUMBER:response:int}·(?:-\|%{NUMBER:bytes:int})·%{QS:referrer}·%{QS:agent}| } =&gt; r.message
    default =&gt; null
from in into out
having event != null
</code></pre></div><div id=logstash><pre><code class=language-logstash data-lang=logstash>filter {
  grok {
    match =&gt; {
      &quot;message&quot; =&gt; '%{IPORHOST:clientip} %{USER:ident} %{USER:auth} \[%{HTTPDATE:timestamp}\] &quot;%{WORD:verb} %{DATA:request} HTTP/%{NUMBER:httpversion}&quot; %{NUMBER:response:int} (?:-|%{NUMBER:bytes:int}) %{QS:referrer} %{QS:agent}'
    }
  }
}
</code></pre></div><p>The full documentation <a href=https://docs.tremor.rs/tremor-query>of the language</a>, the <a href=https://docs.tremor.rs/artefacts/operators>special operators</a>, and <a href=https://docs.tremor.rs/tremor-query/functions>aggregation functions</a> can be found in the <a href=https://docs.tremor.rs>docs</a> .</p></div></div></main><footer></footer><script src=/js/kube.js type=text/javascript></script><script src=/js/kube.legenda.js type=text/javascript></script><script src=/js/master.js type=text/javascript></script></body></html>